<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de Página</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 300px;
      background-color: #333;
      color: white;
      padding: 20px;
    }

    .menu-item {
      margin-bottom: 20px;
    }

    .menu-item label {
      display: block;
      margin-bottom: 5px;
    }

    .menu-item input[type="number"],
    .menu-item select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .menu-item input[type="checkbox"] {
      margin-right: 8px;
    }

    .button {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #45a049;
    }

    .invert-size {
      background-color: #ff9800;
    }

    .invert-size:hover {
      background-color: #f57c00;
    }

    .file-upload {
      display: inline-block;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }

    .file-upload input[type="file"] {
      display: none;
    }

    .page-container {
      flex: 1;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      overflow: auto;
    }

    .page {
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      position: relative;
      border: 1px solid #ddd;
    }

    .page img {
      object-fit: cover;
      display: block;
    }

    .number-container {
      position: absolute;
      cursor: move;
      user-select: none;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 5px;
      border: 1px solid #ccc;
    }

    .number-content {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .resize-handle {
      width: 10px;
      height: 10px;
      background-color: #4CAF50;
      position: absolute;
    }

    .resize-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
    .resize-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
    .resize-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
    .resize-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

    .generate-pdf {
      margin-top: 20px;
      background-color: #2196F3;
    }

    .generate-pdf:hover {
      background-color: #1976D2;
    }

    .delete-btn {
      position: absolute;
      top: -20px;
      right: -20px;
      width: 20px;
      height: 20px;
      background-color: #ff4444;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      line-height: 1;
    }

    .delete-btn:hover {
      background-color: #cc0000;
    }

    @media print {
      .sidebar {
        display: none;
      }
      
      .page-container {
        padding: 0;
      }
      
      .page {
        box-shadow: none;
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="menu-item">
        <label class="file-upload">
          <input type="file" id="imageUpload" accept="image/*">
          Enviar Imagem
        </label>
      </div>
      
      <div class="menu-item">
        <label>Largura (cm):
          <input type="number" id="width" value="21" min="1" step="0.1">
        </label>
      </div>

      <div class="menu-item">
        <button id="invertSize" class="button invert-size">Inverter Tamanho da folha</button>
      </div>

      <div class="menu-item">
        <label>Altura (cm):
          <input type="number" id="height" value="29.7" min="1" step="0.1">
        </label>
      </div>

      <div class="menu-item">
        <label>Margem interna (cm):
          <input type="number" id="margin" value="0.5" min="0" step="0.1">
        </label>
      </div>

      <div class="menu-item">
        <button id="addNumber" class="button">Adicionar Número</button>
      </div>

      <div class="menu-item">
        <label>Fonte:
          <select id="fontFamily">
            <option value="Arial">Arial</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Georgia">Georgia</option>
            <option value="Verdana">Verdana</option>
          </select>
        </label>
      </div>

      <div class="menu-item">
        <label>Tamanho da fonte:
          <input type="number" id="fontSize" value="16" min="8" max="72" step="1">
        </label>
      </div>

      <div class="menu-item">
        <label>
          <input type="checkbox" id="boldText">
          Negrito
        </label>
      </div>

      <div class="menu-item">
        <label>Iniciar em:
          <input type="number" id="startNumber" value="1" min="0" step="1">
        </label>
      </div>

      <div class="menu-item">
        <label>Terminar em:
          <input type="number" id="endNumber" value="100" min="0" step="1">
        </label>
      </div>

      <div class="menu-item">
        <button id="generatePdfBtn" class="button generate-pdf">Gerar PDF</button>
      </div>
    </div>

    <div class="page-container">
      <div class="page" id="page">
      </div>
    </div>
  </div>

  <script>
    // Global storage for number templates
    window.numberTemplates = [];

    window.generatePDF = function() {
      if (window.numberTemplates.length === 0) {
        alert('Por favor, adicione pelo menos um número primeiro.');
        return;
      }

      // Find the maximum end number to determine total pages needed
      const maxEnd = Math.max(...window.numberTemplates.map(t => t.endNum));
      const minStart = Math.min(...window.numberTemplates.map(t => t.startNum));
      
      const printWindow = window.open('', '_blank');
      const page = document.getElementById('page');
      const basePageHtml = page.cloneNode(true);
      
      // Remove any existing number containers from the base page
      const existingNumbers = basePageHtml.querySelectorAll('.number-container');
      existingNumbers.forEach(num => num.remove());

      // Create HTML content for all pages
      let pagesHtml = '';
      
      // Generate pages from minStart to maxEnd
      for (let currentPage = minStart; currentPage <= maxEnd; currentPage++) {
        // Check if any template has a number for this page
        const hasNumberOnPage = window.numberTemplates.some(template => {
          const currentNumber = template.startNum + (currentPage - minStart);
          return currentNumber >= template.startNum && currentNumber <= template.endNum;
        });

        // Skip page generation if no numbers would appear on this page
        if (!hasNumberOnPage) continue;

        const pageClone = basePageHtml.cloneNode(true);
        
        // For each template, calculate its current number
        window.numberTemplates.forEach(template => {
          const numberContainer = document.createElement('div');
          numberContainer.className = 'number-container';
          numberContainer.style.width = template.width;
          numberContainer.style.height = template.height;
          numberContainer.style.left = template.left;
          numberContainer.style.top = template.top;
          
          const content = document.createElement('div');
          content.className = 'number-content';
          content.style.fontFamily = template.fontFamily;
          content.style.fontSize = `${template.fontSize}px`;
          content.style.fontWeight = template.fontWeight;
          
          // Calculate the current number for this template based on its position in sequence
          let currentNumber = template.startNum + (currentPage - minStart);
          
          // Only show the number if it's within the template's range
          if (currentNumber >= template.startNum && currentNumber <= template.endNum) {
            content.textContent = currentNumber;
          }
          
          numberContainer.appendChild(content);
          pageClone.appendChild(numberContainer);
        });
        
        pagesHtml += `<div class="pdf-page">${pageClone.outerHTML}</div>`;
      }

      printWindow.document.write(`
        <html>
          <head>
            <style>
              body { margin: 0; padding: 20px; }
              .pdf-page { 
                margin-bottom: 20px;
              }
              .pdf-page:last-child {
                margin-bottom: 0;
              }
              .page {
                background-color: white;
                position: relative;
                margin: 0 auto;
              }
              .number-container {
                position: absolute;
                background-color: rgba(255, 255, 255, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
              }
              .number-content {
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
              }
              img {
                display: block;
                object-fit: cover;
              }
              @media print {
                body { margin: 0; padding: 0; }
                .pdf-page { 
                  margin: 0;
                  page-break-after: always;
                }
                .pdf-page:last-child {
                  page-break-after: avoid;
                }
              }
            </style>
          </head>
          <body>
            ${pagesHtml}
          </body>
        </html>
      `);
      printWindow.document.close();
      
      setTimeout(() => {
        printWindow.print();
      }, 500);
    };

    document.addEventListener('DOMContentLoaded', () => {
      const page = document.getElementById('page');
      const widthInput = document.getElementById('width');
      const heightInput = document.getElementById('height');
      const marginInput = document.getElementById('margin');
      const imageUpload = document.getElementById('imageUpload');
      const addNumberBtn = document.getElementById('addNumber');
      const startNumberInput = document.getElementById('startNumber');
      const endNumberInput = document.getElementById('endNumber');
      const generatePdfBtn = document.getElementById('generatePdfBtn');
      const invertSizeBtn = document.getElementById('invertSize');
      const fontFamilySelect = document.getElementById('fontFamily');
      const fontSizeInput = document.getElementById('fontSize');
      const boldTextCheckbox = document.getElementById('boldText');

      // Converter cm para px (assumindo 96 DPI)
      const cmToPx = (cm) => cm * 37.795275591;

      function updatePageSize() {
        const width = cmToPx(widthInput.value);
        const height = cmToPx(heightInput.value);
        const margin = cmToPx(marginInput.value);

        page.style.width = `${width}px`;
        page.style.height = `${height}px`;
        page.style.padding = '0';

        const img = page.querySelector('img');
        if (img) {
          img.style.margin = `${margin}px`;
          img.style.width = `${width - (margin * 2)}px`;
          img.style.height = `${height - (margin * 2)}px`;
        }
      }

      // Add invert size functionality
      invertSizeBtn.addEventListener('click', () => {
        const currentWidth = widthInput.value;
        const currentHeight = heightInput.value;
        
        widthInput.value = currentHeight;
        heightInput.value = currentWidth;
        
        updatePageSize();
      });

      function createNumberElement() {
        const container = document.createElement('div');
        container.className = 'number-container';
        container.style.width = '100px';
        container.style.height = '50px';
        container.style.left = '50px';
        container.style.top = '50px';

        const content = document.createElement('div');
        content.className = 'number-content';
        content.textContent = startNumberInput.value;
        
        // Apply font styles
        content.style.fontFamily = fontFamilySelect.value;
        content.style.fontSize = `${fontSizeInput.value}px`;
        content.style.fontWeight = boldTextCheckbox.checked ? 'bold' : 'normal';

        // Add delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.innerHTML = '×';
        deleteBtn.addEventListener('click', () => {
          const index = window.numberTemplates.indexOf(newTemplate);
          if (index > -1) {
            window.numberTemplates.splice(index, 1);
          }
          container.remove();
        });
        container.appendChild(deleteBtn);

        const handles = ['nw', 'ne', 'sw', 'se'];
        handles.forEach(pos => {
          const handle = document.createElement('div');
          handle.className = `resize-handle ${pos}`;
          container.appendChild(handle);
        });

        container.appendChild(content);
        page.appendChild(container);

        // Create a new template with font properties
        const newTemplate = {
          width: container.style.width,
          height: container.style.height,
          left: container.style.left,
          top: container.style.top,
          startNum: parseInt(startNumberInput.value),
          endNum: parseInt(endNumberInput.value),
          fontFamily: fontFamilySelect.value,
          fontSize: fontSizeInput.value,
          fontWeight: boldTextCheckbox.checked ? 'bold' : 'normal'
        };

        window.numberTemplates.push(newTemplate);

        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;

        container.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
          if (e.target.classList.contains('resize-handle')) return;
          
          initialX = e.clientX - container.offsetLeft;
          initialY = e.clientY - container.offsetTop;
          
          isDragging = true;
        }

        function drag(e) {
          if (!isDragging) return;

          e.preventDefault();
          
          currentX = e.clientX - initialX;
          currentY = e.clientY - initialY;

          const bounds = page.getBoundingClientRect();
          const containerBounds = container.getBoundingClientRect();

          currentX = Math.max(0, Math.min(currentX, bounds.width - containerBounds.width));
          currentY = Math.max(0, Math.min(currentY, bounds.height - containerBounds.height));

          container.style.left = currentX + 'px';
          container.style.top = currentY + 'px';

          // Update template position
          newTemplate.left = container.style.left;
          newTemplate.top = container.style.top;
        }

        function dragEnd() {
          isDragging = false;
        }

        // Implement resizing
        const resizeHandles = container.querySelectorAll('.resize-handle');
        resizeHandles.forEach(handle => {
          handle.addEventListener('mousedown', initResize);
        });

        function initResize(e) {
          e.stopPropagation();
          
          const handle = e.target;
          const isLeft = handle.classList.contains('nw') || handle.classList.contains('sw');
          const isTop = handle.classList.contains('nw') || handle.classList.contains('ne');
          
          const startX = e.clientX;
          const startY = e.clientY;
          const startWidth = parseInt(container.style.width);
          const startHeight = parseInt(container.style.height);
          const startLeft = parseInt(container.style.left);
          const startTop = parseInt(container.style.top);

          function resize(e) {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            if (isLeft) {
              const newWidth = startWidth - dx;
              if (newWidth > 50) {
                container.style.width = newWidth + 'px';
                container.style.left = (startLeft + dx) + 'px';
              }
            } else {
              const newWidth = startWidth + dx;
              if (newWidth > 50) {
                container.style.width = newWidth + 'px';
              }
            }

            if (isTop) {
              const newHeight = startHeight - dy;
              if (newHeight > 30) {
                container.style.height = newHeight + 'px';
                container.style.top = (startTop + dy) + 'px';
              }
            } else {
              const newHeight = startHeight + dy;
              if (newHeight > 30) {
                container.style.height = newHeight + 'px';
              }
            }

            // Update template size
            newTemplate.width = container.style.width;
            newTemplate.height = container.style.height;
          }

          function stopResize() {
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
          }

          document.addEventListener('mousemove', resize);
          document.addEventListener('mouseup', stopResize);
        }
      }

      // Event listeners
      addNumberBtn.addEventListener('click', createNumberElement);
      widthInput.addEventListener('input', updatePageSize);
      heightInput.addEventListener('input', updatePageSize);
      marginInput.addEventListener('input', updatePageSize);
      generatePdfBtn.addEventListener('click', window.generatePDF);

      imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const img = document.createElement('img');
            img.src = event.target.result;
            img.style.display = 'block';
            img.style.objectFit = 'cover';
            
            page.innerHTML = '';
            page.appendChild(img);
            
            updatePageSize();
          };
          reader.readAsDataURL(file);
        }
      });

      // Inicializar tamanho da página
      updatePageSize();
    });
  </script>
</body>
</html>
